---
title: 'Encuesta: Relaciones entre variables'
author: "Juan Sebastian Cely"
date: "`r Sys.Date()`"
output: github_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
stopifnot(require(openxlsx), require(kableExtra), require(dm), require(dplyr), require (ggplot2), require(rms), require(caret), require(lmtest), require(car), require(yardstick), require(papaja), require(pandoc), require(tinytex), require(RColorBrewer), require(ggplotify), require(FactoMineR), require(factoextra), require(Factoshiny), require(effectsize))
knitr::opts_chunk$set(cache=F,fig.path="./figures",cache.rebuild = F, out.width = "80%")
options(knitr.table.format = "simple")
```

```{r data, include=FALSE}
wb<-loadWorkbook("C:\\Users\\sebas\\OneDrive\\Documents\\JSCA2\\Research\\Current_R_projects\\col_youth_climate_change\\Analyses\\020-22 Base de Datos Anonimizada V4 (1).xlsx")
names(wb)
data1 <- readWorkbook(wb,sheet=1)
codeBook1 <- readWorkbook(wb,sheet=2,skipEmptyRows = F)
```

```{r tranformación y recodificación variables, include=FALSE}
# Eco-anxiety
neg_emo <- c("C36_1", "C36_3", "C36_4", "C36_5", "C36_6", "C36_7", "C36_8", "C36_9", "C36_10", "C36_11", "C36_15")
amb_emo <- c("C36_13")
pos_emo <- c("C36_2", "C36_12", "C36_14", "C36_16")
data1$eco_anx <- NA
for (i in 1:nrow(data1)) {
neg_emo_count <- sum(data1[i, neg_emo] == 1)
pos_emo_count <- sum(data1[i, pos_emo] == 1)
amb_emo_count <- sum(data1[i, amb_emo] == 1)
if (neg_emo_count %in% c(1, 2) & pos_emo_count == 0 & amb_emo_count == 0) {
data1$eco_anx[i] <- "Negativas"
} else if (neg_emo_count == 1 & pos_emo_count == 1 & amb_emo_count == 0) {
data1$eco_anx[i] <- "Ambivalentes/Neutrales"
} else if (neg_emo_count == 1 & pos_emo_count == 0 & amb_emo_count == 1) {
data1$eco_anx[i] <- "Ambivalentes/Neutrales"
} else if (neg_emo_count == 0 & pos_emo_count == 1 & amb_emo_count == 1) {
data1$eco_anx[i] <- "Ambivalentes/Neutrales"
} else if (neg_emo_count == 0 & pos_emo_count == 0 & amb_emo_count == 1) {
data1$eco_anx[i] <- "Ambivalentes/Neutrales"
} else if (neg_emo_count == 0 & pos_emo_count %in% c(1, 2) & amb_emo_count == 0) {
data1$eco_anx[i] <- "Positivas"
}
}
data1$eco_anx <- factor(data1$eco_anx, levels = c("Negativas", "Ambivalentes/Neutrales", "Positivas"))

# Emotional arousal
high_ar <- c("C36_2", "C36_3", "C36_4", "C36_5", "C36_6", "C36_7", "C36_9", "C36_12", "C36_14")
low_ar <- c("C36_1", "C36_8", "C36_10", "C36_11", "C36_13", "C36_15", "C36_16")
data1$eco_anx2 <- NA
for (i in 1:nrow(data1)) {
high_ar_count <- sum(data1[i, high_ar] == 1)
low_ar_count <- sum(data1[i, low_ar] == 1)
if (high_ar_count %in% c(1, 2) & low_ar_count == 0) {
data1$eco_anx2[i] <- "Alta activación"
} else if (high_ar_count == 1 & low_ar_count == 1) {
data1$eco_anx2[i] <- "Ambivalente/Neutra"
} else if (high_ar_count == 0 & low_ar_count %in% c(1, 2)) {
data1$eco_anx2[i] <- "Baja activación"
}
}
data1$eco_anx2 <- factor(data1$eco_anx2, levels = c("Baja activación", "Ambivalente/Neutra", "Alta activación"))

unp_deac <- c("C36_1", "C36_10", "C36_11", "C36_15")
unp_act <- c("C36_3", "C36_4", "C36_5", "C36_6", "C36_7", "C36_8", "C36_9")
pos <- c("C36_13", "C36_16", "C36_2", "C36_12", "C36_14")
data1$cir_mod <- NA
for (i in 1:nrow(data1)) {
unp_deac_count <- sum(data1[i, unp_deac] == 1)
unp_act_count <- sum(data1[i, unp_act] == 1)
pos_count <- sum(data1[i, pos] == 1)
if (unp_deac_count %in% c(1, 2) & unp_act_count == 0 & pos_count == 0) {
data1$cir_mod[i] <- "Neg no act"
} else if (unp_deac_count == 1 & unp_act_count == 1 & pos_count == 0) {
data1$cir_mod[i] <- "Neg no act y act"
} else if (unp_deac_count == 1 & unp_act_count == 0 & pos_count == 1) {
data1$cir_mod[i] <- "Pos y neg no act"
} else if (unp_deac_count == 0 & unp_act_count %in% c(1, 2) & pos_count == 0) {
data1$cir_mod[i] <- "Neg act"
} else if (unp_deac_count == 0 & unp_act_count == 1 & pos_count == 1) {
data1$cir_mod[i] <- "Pos y neg act"
} else if (unp_deac_count == 0 & unp_act_count == 0 & pos_count %in% c(1, 2)) {
data1$cir_mod[i] <- "Pos"
}
}
data1$cir_mod <- factor(data1$cir_mod, levels = c("Pos", "Pos y neg act", "Pos y neg no act", "Neg act", "Neg no act y act", "Neg no act"))

# Residential area
data1$Zona <- as.factor(data1$Zona)

# Sex
data1$A1 <- as.factor(data1$A1)
levels(data1$A1) <- c("Hombre", "Mujer")
data1$sex <- data1$A1

# Age range
data1$RANGO_EDAD <- as.factor(data1$RANGO_EDAD)
data1$age_r <- data1$RANGO_EDAD
data1 <- data1 %>%
  mutate(age_r = case_when(
    age_r == 1 ~ "De 18 a 20 años",
    age_r == 2 ~ "De 21 a 24 años",
    age_r == 3 ~ "De 25 a 29 años",
    age_r == 4 ~ "De 30 a 32 años"
))
data1$age_r <- as.factor(data1$age_r)
data1$edad <- data1$A2

# Stratum
data1$estrato <- as.factor(data1$A3)
data1$strat <- data1$A3
data1 <- data1 %>%
  mutate(strat = case_when(
    strat %in% c(1,2) ~ "Bajo",
    strat %in% c(3,4) ~ "Medio",
    strat %in% c(5,6) ~ "Alto"
))
data1$strat <- factor(data1$strat, levels = c("Bajo", "Medio", "Alto"))

# Ethnics
data1$A5 <- as.factor(data1$A5)
levels(data1$A5) <- c("Indígena", "Gitana(o) Rrom", "Raizal", "Palenquera(o)", "Afro", "Ninguna")
data1$etnia <- data1$A5
data1 <- data1 %>%
  mutate(ethni = case_when(
    etnia != "Ninguna" ~ "Sí",
    etnia == "Ninguna" ~ "No"
))
data1$ethni <- as.factor(data1$ethni)

# Education
data1$education <- as.factor(data1$A6)
levels(data1$education) <- c("Básica Primaria", "Básica Secundaria", "Secundaria Completa", "Técnico o Tecnólogo", "Pregrado", "Posgrado")

data1 <- data1 %>%
  mutate(edu = case_when(
    education %in% c("Básica Primaria", "Básica Secundaria", "Secundaria Completa", "Técnico o Tecnólogo") ~ "No",
    education %in% c("Pregrado", "Posgrado") ~ "Sí"
))
data1$edu <- as.factor(data1$edu)

# Kids
data1$A9 <- as.factor(data1$A9)
levels(data1$A9) <- c("Sí", "No")
data1$kids <- data1$A9

# Political ideology
data1$A11 <- as.factor(data1$A11)
data1 <- data1 %>%
  mutate(ideology = case_when(
    A11 %in% c(1, 2) ~ "Izquierda",
    A11 %in% c(3, 4) ~ "Centro",
    A11 %in% c(5, 6) ~ "Derecha"
  ))
data1$ideology <- factor(data1$ideology, levels = c("Derecha", "Centro", "Izquierda"))

# Medios según tipo
trad_med <- c("B12_1", "B12_2", "B12_3", "B12_89")
int_med <- c("B12_4", "B12_5")
data1$media <- NA
for (i in 1:nrow(data1)) {
trad_med_count <- sum(data1[i, trad_med] == 1)
int_med_count <- sum(data1[i, int_med] == 1)
if (trad_med_count %in% c(1:4) & int_med_count == 0) {
data1$media[i] <- "Solo tradicionales"
} else if (trad_med_count %in% c(1:4) & int_med_count %in% c(1:2)) {
data1$media[i] <- "Mixtos"
} else if (trad_med_count == 0 & int_med_count %in% c(1:2)) {
data1$media[i] <- "Solo internet"
}
}
data1$media <- factor(data1$media, levels = c("Solo tradicionales", "Mixtos", "Solo internet"))


# Medios según si es validada o no
val_med <- c("B12_1", "B12_2", "B12_3", "B12_4")
no_val_med <- c("B12_5", "B12_89")
data1$med <- NA
for (i in 1:nrow(data1)) {
val_med_count <- sum(data1[i, val_med] == 1)
no_val_med_count <- sum(data1[i, no_val_med] == 1)
if (val_med_count %in% c(1:4) & no_val_med_count == 0) {
data1$med[i] <- "Fuentes validadas"
} else if (val_med_count %in% c(1:4) & no_val_med_count %in% c(1:2)) {
data1$med[i] <- "Fuentes mixtas"
} else if (val_med_count == 0 & no_val_med_count %in% c(1:2)) {
data1$med[i] <- "Fuentes no validadas"
}
}
data1$med <- factor(data1$med, levels = c("Fuentes validadas", "Fuentes mixtas", "Fuentes no validadas"))

# Information sources
data1 <- data1 %>%
  rename(Televisión = B12_1,
         Radio = B12_2,
         Prensa_Impresa = B12_3,
         Medios_Digitales = B12_4,
         Redes_Sociales = B12_5,
         Otro_medio = B12_89)

vars_to_convert <- c("Televisión",
         "Radio",
         "Prensa_Impresa",
         "Medios_Digitales",
         "Redes_Sociales",
         "Otro_medio")

for (var in vars_to_convert) {
  data1[[var]] <- factor(data1[[var]])
}
new_levels <- c("No", "Sí")
for (var in vars_to_convert) {
  levels(data1[[var]]) <- new_levels
}

data1 <- data1 %>%
  mutate(Internet = case_when(
    Medios_Digitales == "Sí" & Redes_Sociales == "Sí" ~ "Sí",
    Medios_Digitales == "Sí" & Redes_Sociales == "No" ~ "Sí",
    Medios_Digitales == "No" & Redes_Sociales == "Sí" ~ "Sí",
    Medios_Digitales == "No" & Redes_Sociales == "No" ~ "No"
  ))
data1$Internet <- as.factor(data1$Internet)


# Trust in particular Institutions and figures
trust_vote_inst <- data1 %>%
  select(C17_5, C17_7, C17_8)
trust_vote_inst[] <- lapply(trust_vote_inst, function(x) replace(x, x == 2, -1))
trust_vote_inst[] <- lapply(trust_vote_inst, function(x) replace(x, x == 3, 0))
data1$trust_vote_inst <- rowSums(trust_vote_inst)
data1$trust_vote_inst <- as.factor(data1$trust_vote_inst)

data1 <- data1 %>%
  mutate(trust_vote_inst = case_when(
    trust_vote_inst %in% c("-3", "-2", "-1") ~ "No",
    trust_vote_inst %in% c("0", "1", "2", "3") ~ "Sí"
  ))
data1$trust_vote_inst <- factor(data1$trust_vote_inst, levels = c("No", "Sí"))

#trust_unis <- data1 %>%
  #select(C17_14, C17_15)
#trust_unis[] <- lapply(trust_unis, function(x) replace(x, x == 2, -1))
#trust_unis[] <- lapply(trust_unis, function(x) replace(x, x == 3, 0))
#data1$trust_unis <- rowSums(trust_unis)
#data1$trust_unis <- as.factor(data1$trust_unis)

data1$aso <- data1$C18_7
for (i in 1:nrow(data1)) {
  if (data1$aso[i] == 1) {
    data1$aso[i] <- 1
  } else if (data1$aso[i] == 2) {
    data1$aso[i] <- -1
  }
}

# Join an environmental organization
data1$C18_7 <- as.factor(data1$C18_7)
levels(data1$C18_7) <- c("Sí", "No")
data1$env_aso <- data1$C18_7

# Negative emotions towards actions taken by the government regarding climate change
neg_d34 <- c("D34_2", "D34_3", "D34_4", "D34_6", "D34_8", "D34_9")
pos_d34 <- c("D34_1", "D34_5", "D34_7", "D34_10")
data1$neg_emo_gov <- NA
for (i in 1:nrow(data1)) {
  data1$neg_emo_gov[i] <- sum(data1[i, neg_d34]) - sum(data1[i, pos_d34]) + 19
}

# Impact of scientists on climate change
data1$imp_scien <- data1$D35_1
data1$imp_scien[data1$imp_scien == 99] <- 3.5
value_mapping <- c(1, 2, 3, 3.5, 4, 5, 6)
new_values <- c(-3, -2, -1, 0, 1, 2, 3)
data1$imp_scien <- new_values[match(data1$imp_scien, value_mapping)]
data1$imp_scien <- as.factor(data1$imp_scien)

data1 <- data1 %>%
  mutate(imp_sci = case_when(
    imp_scien %in% c("-3", "-2") ~ "Negativo",
    imp_scien %in% c("-1", "0", "1") ~ "Neutro",
    imp_scien %in% c("2", "3") ~ "Positivo"
  ))
data1$imp_sci <- as.factor(data1$imp_sci)

# Impact of activists on climate change
data1$imp_act <- data1$D35_7
data1$imp_act[data1$imp_act == 99] <- 3.5
value_mapping <- c(1, 2, 3, 3.5, 4, 5, 6)
new_values <- c(-3, -2, -1, 0, 1, 2, 3)
data1$imp_act <- new_values[match(data1$imp_act, value_mapping)]
data1$imp_act <- as.factor(data1$imp_act)

data1 <- data1 %>%
  mutate(imp_ac = case_when(
    imp_act %in% c("-3", "-2") ~ "Negativo",
    imp_act %in% c("-1", "0", "1") ~ "Neutro",
    imp_act %in% c("2", "3") ~ "Positivo"
  ))
data1$imp_ac <- as.factor(data1$imp_ac)

# Impact of religious groups on climate change
data1$imp_rel <- data1$D35_3
data1$imp_rel[data1$imp_rel == 99] <- 3.5
value_mapping <- c(1, 2, 3, 3.5, 4, 5, 6)
new_values <- c(-3, -2, -1, 0, 1, 2, 3)
data1$imp_rel <- new_values[match(data1$imp_rel, value_mapping)]
data1$imp_rel <- as.factor(data1$imp_rel)

data1 <- data1 %>%
  mutate(imp_re = case_when(
    imp_rel %in% c("-3", "-2") ~ "Negativo",
    imp_rel %in% c("-1", "0", "1") ~ "Neutro",
    imp_rel %in% c("2", "3") ~ "Positivo"
  ))
data1$imp_re <- as.factor(data1$imp_re)

# Impact of politicians on climate change
data1$imp_pol <- data1$D35_6
data1$imp_pol[data1$imp_pol == 99] <- 3.5
value_mapping <- c(1, 2, 3, 3.5, 4, 5, 6)
new_values <- c(-3, -2, -1, 0, 1, 2, 3)
data1$imp_pol <- new_values[match(data1$imp_pol, value_mapping)]
data1$imp_pol <- as.factor(data1$imp_pol)

data1 <- data1 %>%
  mutate(imp_po = case_when(
    imp_pol %in% c("-3", "-2") ~ "Negativo",
    imp_pol %in% c("-1", "0", "1") ~ "Neutro",
    imp_pol %in% c("2", "3") ~ "Positivo"
  ))
data1$imp_po <- as.factor(data1$imp_po)

# Thoughts about climate change
pos_thought <- c("C37_9", "C37_11", "C37_12", "C37_13", "C37_15")
neg_thought<- c("C37_1", "C37_2", "C37_4", "C37_5", "C37_6", "C37_7", "C37_8", "C37_14")
neut_thought <- c("C37_3", "C37_10")
data1$thoughts <- NA
for (i in 1:nrow(data1)) {
neg_th_count <- sum(data1[i, neg_thought] == 1)
pos_th_count <- sum(data1[i, pos_thought] == 1)
amb_th_count <- sum(data1[i, neut_thought] == 1)
if (neg_th_count %in% c(1, 2, 3) & pos_th_count == 0 & amb_th_count == 0) {
data1$thoughts[i] <- "Negativos"
} else if (neg_th_count == 2 & pos_th_count == 1 & amb_th_count == 0) {
data1$thoughts[i] <- "Ambivalentes/Neutrales"
} else if (neg_th_count == 2 & pos_th_count == 0 & amb_th_count == 1) {
data1$thoughts[i] <- "Ambivalentes/Neutrales"
} else if (neg_th_count == 1 & pos_th_count == 1 & amb_th_count == 1) {
data1$thoughts[i] <- "Ambivalentes/Neutrales"
} else if (neg_th_count == 1 & pos_th_count == 1 & amb_th_count == 0) {
data1$thoughts[i] <- "Ambivalentes/Neutrales"
} else if (neg_th_count == 1 & pos_th_count == 0 & amb_th_count == 1) {
data1$thoughts[i] <- "Ambivalentes/Neutrales"
} else if (neg_th_count == 0 & pos_th_count %in% c(1, 2, 3) & amb_th_count == 0) {
data1$thoughts[i] <- "Positivos"
} else if (neg_th_count == 1 & pos_th_count == 2 & amb_th_count == 0) {
data1$thoughts[i] <- "Ambivalentes/Neutrales"
} else if (neg_th_count == 0 & pos_th_count == 2 & amb_th_count == 1) {
data1$thoughts[i] <- "Ambivalentes/Neutrales"
} else if (neg_th_count == 0 & pos_th_count == 1 & amb_th_count == 1) {
data1$thoughts[i] <- "Ambivalentes/Neutrales"
} else if (neg_th_count == 0 & pos_th_count == 0 & amb_th_count %in% c(1, 2)) {
data1$thoughts[i] <- "Ambivalentes/Neutrales"
} else if (neg_th_count == 1 & pos_th_count == 0 & amb_th_count == 2) {
data1$thoughts[i] <- "Ambivalentes/Neutrales"
} else if (neg_th_count == 0 & pos_th_count == 1 & amb_th_count == 2) {
data1$thoughts[i] <- "Ambivalentes/Neutrales"
}
}
data1$thoughts <- factor(data1$thoughts, levels = c("Negativos", "Ambivalentes/Neutrales", "Positivos"))

c38 <- grep("^C38_", names(data1), value=T)
data1$imp_como <- NA
for (i in 1:nrow(data1)) {
  data1$imp_como[i] <- round(sum(data1[i, c38]) / 10) 
}
for (i in 1:nrow(data1)) {
  if (data1$imp_como[i] == 1) {
    data1$imp_como[i] <- -3
  } else if (data1$imp_como[i] == 2) {
    data1$imp_como[i] <- -2
  } else if (data1$imp_como[i] == 3) {
    data1$imp_como[i] <- -1
  } else if (data1$imp_como[i] == 4) {
    data1$imp_como[i] <- 1
  } else if (data1$imp_como[i] == 5) {
    data1$imp_como[i] <- 2
  } else if (data1$imp_como[i] == 6) {
    data1$imp_como[i] <- 3
  }
}

c39 <- grep("^C39_", names(data1), value=T)
data1$imp_cli <- NA
for (i in 1:nrow(data1)) {
  data1$imp_cli[i] <- round(sum(data1[i, c39]) / 10)
}
for (i in 1:nrow(data1)) {
  if (data1$imp_cli[i] == 1) {
    data1$imp_cli[i] <- -3
  } else if (data1$imp_cli[i] == 2) {
    data1$imp_cli[i] <- -2
  } else if (data1$imp_cli[i] == 3) {
    data1$imp_cli[i] <- -1
  } else if (data1$imp_cli[i] == 4) {
    data1$imp_cli[i] <- 1
  } else if (data1$imp_cli[i] == 5) {
    data1$imp_cli[i] <- 2
  } else if (data1$imp_cli[i] == 6) {
    data1$imp_cli[i] <- 3
  }
}

data1$dis_act <- data1$imp_cli + data1$imp_como
data1 <- data1 %>%
  mutate(dis_act = case_when(
    dis_act %in% c(-6, -5, -4) ~ "Poco dispuesta",
    dis_act %in% c(-3, -2, -1) ~ "Poco dispuesta",
    dis_act == 0 ~ "Poco dispuesta",
    dis_act %in% c(1, 2, 3) ~ "Dispuesta",
    dis_act %in% c(4, 5, 6) ~ "Muy dispuesta",
))
data1$dis_act <- factor(data1$dis_act, levels = c("Poco dispuesta", "Dispuesta", "Muy dispuesta"))

# Impact of individual actions separated
data1 <- data1 %>%
  rename(no_car = C39_1, 
         one_fw_ch = C39_4,
         veg = C39_6,
         only_bk_wk = C39_7)

vars_to_convert <- c("no_car", "one_fw_ch",
         "veg",
         "only_bk_wk")

for (var in vars_to_convert) {
  data1[[var]] <- factor(data1[[var]])
}
new_levels <- c("-3", "-2", "-1", "1", "2", "3")
for (var in vars_to_convert) {
  levels(data1[[var]]) <- new_levels
}


# Climate change origin
data1$C40 <- as.factor(data1$C40)
data1 <- data1 %>%
  mutate(clim_ori = case_when(
    C40 %in% c(1,2) ~ "0 a 20%",
    C40 %in% c(3,4) ~ "20 a 40%",
    C40 %in% c(5,6) ~ "40 a 60%",
    C40 %in% c(7,8) ~ "60 a 80%",
    C40 %in% c(9,10) ~ "80 a 100%"
    ))
data1$clim_ori <- as.factor(data1$clim_ori)

# Climate change origin binary
data1$C40 <- as.factor(data1$C40)
data1 <- data1 %>%
  mutate(clim_origin = case_when(
    C40 %in% c(1,2,3,4,5,6,7,8) ~ "Incorrecta",
    C40 %in% c(9,10) ~ "Correcta"
    ))
data1$clim_origin <- as.factor(data1$clim_origin)

# Contribution to climate change
data1$C41 <- as.factor(data1$C41)
data1 <- data1 %>%
  mutate(cont_clim = case_when(
    C41 %in% c(1, 3, 4) ~ "Incorrecta",
    C41 == 2 ~ "Correcta"
))
data1$cont_clim <- as.factor(data1$cont_clim)
```


# Variables y categorias
Tras el proceso de codificación, las variables de interés fueron agrupadas en un nuevo data frame. A continuación se presentan dos tablas. En la primera se encuentran las variables y una breve descripción de cada una, y en la segunda se encuentran las variables, cada una de sus categorías y la frecuencia correspondiente a cada categoría.
```{r data frame variables categoricas, echo=FALSE}
data1 <- data1 %>%
  mutate(across(starts_with("C36"), as.factor))
data2 <- data1 %>%
  select(Zona, sex, age_r, estrato, ethni, education, kids, ideology, Internet, trust_vote_inst, eco_anx, imp_scien, imp_act, imp_rel, imp_pol, thoughts, dis_act, clim_origin, cont_clim, C36_1, C36_2, C36_3, C36_4, C36_5, C36_6, C36_7, C36_8, C36_9, C36_10, C36_11, C36_12, C36_13, C36_14, C36_15, C36_16)

data3 <- data1 %>%
  select(Zona, sex, age_r, strat, ethni, edu, kids, ideology, Internet, trust_vote_inst, eco_anx, imp_sci, imp_ac, imp_re, imp_po, thoughts, dis_act, clim_origin, cont_clim)
# Not included: Negative emotions towards government actions against climate change, Alternative media

codigo <- c("Zona", "sex", "age_r", "strat", "ethni", "edu", "kids", "ideology", "Internet", "trust_vote_inst", "eco_anx", "imp_sci", "imp_ac", "imp_re", "imp_po", "thoughts", "dis_act", "clim_origin", "cont_clim")
descripcion <- c("Zona de residencia", "Sexo", "Rango de edad", "Estrato socioeconómico", "Pertenece a alguna etnia", "Tiene estudios de educación superior", "Tiene hijos", "Ideología política", "Se informa a través de internet", "Confía en las instituciones con cargos de elección popular", "Emociones frente al cambio climático", "Impacto de los científicos frente al cambio climático", "Impacto de activistas frente al cambio climático", "Impacto de grupos religiosos frente al cambio climático", "Impacto de políticos frente al cambio climático", "Pensamientos frente al cambio climático", "Disposición actuar cambio climático", "Causa u origen del cambio climático", "Factor que más contribuye al cambio climático")
table_vars <- data.frame(codigo, descripcion)
kable(table_vars, col.names = c("Código de la variable", "Descripción de la variable"), booktabs = TRUE)

result <- data.frame(Variable = character(), Category = character(), Frequency = integer(), stringsAsFactors = FALSE)

# Loop through each variable and compute frequencies
for (var in names(data3)) {
  freq_table <- table(data3[[var]])  # Compute frequencies
  var_result <- data.frame(Variable = var, Category = names(freq_table), Frequency = as.vector(freq_table))  # Convert table to data frame
  result <- rbind(result, var_result)  # Append to the result data frame
}
# Print the resulting data frame
kable(result, col.names = c("Variable", "Categoría", "Frecuencia"), booktabs = TRUE)
```

# Análisis de correspondencia múltiple
Teniendo un conjunto de variables de categóricas provenientes de la encuesta se procedió a realizar un análisis de componentes múltiples. Esto con el propósito de explorar las posibles agrupaciones de individuos y las relaciones entre las variables y cada una de sus categorias.

## Análisis con todas las variables como variables activas en la conformación de las dimensiones
Los datos no son muy claros, la ausencia de una o dos dimensiones dominantes con un gran porcentaje de varianza explicada sugiere que no hay un único patrón que domine los datos. En cambio, la variación se distribuye en múltiples dimensiones, cada una capturando una parte relativamente pequeña de la varianza total. Es positivo que el análisis parece mostrar que no hay sesgos grandes o evidentes en los datos. Esto se evidencia por un lado en la ausencia de clusters de individuos separados del resto que estén siendo influenciados por una variable particular. Tampoco se observan asociaciones inusuales entre categorías de las variables como podría ser una cercanía entre la categoría de estrato alto y un nivel inferior de educación formal obtenida.

Aunque no muy claras, es posible ver posibles asociaciones entre categorías que pueden ser de interés. Especialmente, relaciones que incluyan a las variables relacionadas con el conocimiento sobre el origen del cambio climático y las emociones frente al cambio climático. Así, resulta interesante trazar una diagonal imaginaria que va desde la esquina inferior izquierda hacia la esquina superior derecha. Esta diagonal separa individuos que no parecen presentar preocupación por el cambio climático, y que no entienden bien su origen y lo que podemos hacer frente a él, de aquellos que sienten preocupación por este fenomeno al entender su origen en la actividad humana, y que consideran que es posible hacer algo frente a él de manera individual. Así, la variabilidad entre individuos puede entenderse en cierta medida a partir de esta diagonal. Algunas pocas variables demográficas podrían hacer parte de estos dos perfiles aunque no es muy marcado ni clara su contribución. Por ejemplo, se puede observar que el tener o no hijos también podría estar contribuyendo a la distinción entre estos dos perfiles. Individuos sin hijos parecen estar mejor informados sobre el cambio climático y presentar pensamientos y emociones negativas frente a este. En general, las variables demográficas parecen contribuir a una dimensión distinta a aquellas ligadas con opiniones y percepciones frente al cambio climático, por lo que posiblemente no estén asociadas a estas opiniones y percepciones.

```{r análisis de componentes múltiples, echo=FALSE}
res.mca <- MCA(data3, graph = FALSE)
fviz_eig(res.mca, addlabels = TRUE, title = "Inertia of MCA Dimensions")
fviz_mca_ind(res.mca, geom = "point", pointsize = 2, repel = TRUE)
#fviz_mca_biplot(res.mca, geom.ind = "point", repel = TRUE, alpha.ind = 0.1)
fviz_mca_var(res.mca, choice = "var.cat", repel = TRUE)
fviz_mca_var(res.mca, choice = "var", repel = TRUE)
#summary(res.mca, ncp = 2, nbelements = Inf)
fviz(res.mca, element = "ind", geom = "point", pointsize = 2, hab = "eco_anx", alpha = 0.2)
fviz(res.mca, element = "ind", geom = "point", pointsize = 2, hab = "clim_origin", alpha = 0.2)
fviz(res.mca, element = "ind", geom = "point", pointsize = 2, hab = "dis_act", alpha = 0.2)
fviz(res.mca, element = "ind", geom = "point", pointsize = 2, hab = "Internet", alpha = 0.2)
dimdesc(res.mca, axes = 1:2)
```


## Análisis con las variables sociodemográficas como variables suplementarias
Para ver de forma más clara si las variables demográficas podrían estar relacionadas con las dimensiones de variabilidad observadas, estas no fueron incluidas como variables activas en la construcción de las dimensiones, sino como variables suplementarias. Al interpretar el análisis se encuentra que algunas variables demográficas pueden estar relacionadas con algunas de las dimensiones obtenidas, pero su relación con las variables de interés no es muy clara.
```{r análisis de componentes múltiples 2, echo=FALSE}
res.mca <- MCA(data3, quali.sup = c(1:7), graph = FALSE)
fviz_eig(res.mca, addlabels = TRUE, title = "Inertia of MCA Dimensions")
fviz_mca_ind(res.mca, geom = "point", pointsize = 2, repel = TRUE)
#fviz_mca_biplot(res.mca, geom.ind = "point", repel = TRUE, alpha.ind = 0.1)
fviz_mca_var(res.mca, choice = "var.cat", repel = TRUE)
fviz_mca_var(res.mca, choice = "var", repel = TRUE)
#summary(res.mca, ncp = 2, nbelements = Inf)
fviz(res.mca, element = "ind", geom = "point", pointsize = 2, hab = "eco_anx", alpha = 0.2)
fviz(res.mca, element = "ind", geom = "point", pointsize = 2, hab = "clim_origin", alpha = 0.2)
fviz(res.mca, element = "ind", geom = "point", pointsize = 2, hab = "dis_act", alpha = 0.2)
fviz(res.mca, element = "ind", geom = "point", pointsize = 2, hab = "Internet", alpha = 0.2)
dimdesc(res.mca, axes = 1:2)
```

## Conclusión del Análisis de correspondencia múltiple
En general, el análisis permite establecer que no hay sesgos en la muestra, pero tampoco hay claridad en las relaciones entre las variables y en los perfiles de los individuos. Sin embargo, considerando las principales variables de interés, vale la pena explorar asociaciones entre estas y otras variables partiendo de las sútiles pero interesantes relaciones entre categorias observadas en los gráficos.


# Exploración visual de relaciones entre las variables de interés y otras variables
Partiendo de lo observado en el MCA se decidió explorar en gráficos separados las relaciones entre las variables que podrían estar asociadas.

## Origen del cambio climático y emociones frente al cambio climático
```{r relación origen cambio climatico y emociones, fig.align='center', echo=F}
tab_ori_eco_anx <- table(data2$clim_origin, data2$eco_anx)
kable(round(prop.table(tab_ori_eco_anx) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_ori_eco_anx <- data2 %>%
  ggplot(aes(x = clim_origin, fill = eco_anx)) +
  geom_bar(position = "fill") +
  labs(x = "Origen humano del \nCambio climático", y = "Proporción", fill = "Emociones frente al \ncambio climático") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_ori_eco_anx
```

## Pensamientos frente al cambio climático y emociones frente al cambio climático
```{r relación pensamientos y emociones, fig.align='center', echo=F}
tab_th_eco_anx <- table(data2$thoughts, data2$eco_anx)
kable(round(prop.table(tab_th_eco_anx) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_th_eco_anx <- data2 %>%
  ggplot(aes(x = thoughts, fill = eco_anx)) +
  geom_bar(position = "fill") +
  labs(x = "Pensamientos \nfrente al cambio climático", y = "Proporción", fill = "Emociones frente al \ncambio climático") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_th_eco_anx
```

## Ideología política y emociones frente al cambio climático
```{r relación ideologia y emociones, fig.align='center', echo=F}
tab_ide_eco_anx <- table(data2$ideology, data2$eco_anx)
kable(round(prop.table(tab_ide_eco_anx) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_ide_eco_anx <- data2 %>%
  ggplot(aes(x = ideology, fill = eco_anx)) +
  geom_bar(position = "fill") +
  labs(x = "Ideología política", y = "Proporción", fill = "Emociones frente al \ncambio climático") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_ide_eco_anx
```

## Disposición a tomar acciones individuales y emociones frente al cambio climático
```{r disposicion a actuar y emociones, fig.align='center', echo=F}
tab_dis_eco_anx <- table(data2$dis_act, data2$eco_anx)
kable(round(prop.table(tab_dis_eco_anx) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_dis_eco_anx <- data2 %>%
  ggplot(aes(x = dis_act, fill = eco_anx)) +
  geom_bar(position = "fill") +
  labs(x = "Disposición a actuar frente \nal cambio climático", y = "Proporción", fill = "Emociones frente al \ncambio climático") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_dis_eco_anx
```

## Factor que más contribuye al cambio climático y emociones frente al cambio climático
```{r relación contribucion al cambio climatico y emociones, fig.align='center', echo=F}
tab_cont_eco_anx <- table(data2$cont_clim, data2$eco_anx)
kable(round(prop.table(tab_cont_eco_anx) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_cont_eco_anx <- data2 %>%
  ggplot(aes(x = cont_clim, fill = eco_anx)) +
  geom_bar(position = "fill") +
  labs(x = "Quema combustibles fósiles \nmayor contribución al \ncambio climático", y = "Proporción", fill = "Emociones frente al \ncambio climático") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_cont_eco_anx
```

## Uso de internet como fuente de información y emociones frente al cambio climático
```{r relación internet y emociones, fig.align='center', echo=F}
tab_int_eco_anx <- table(data2$Internet, data2$eco_anx)
kable(round(prop.table(tab_int_eco_anx) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_int_eco_anx <- data2 %>%
  ggplot(aes(x = Internet, fill = eco_anx)) +
  geom_bar(position = "fill") +
  labs(x = "Internet como \nfuente de información", y = "Proporción", fill = "Emociones frente al \ncambio climático") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_int_eco_anx
```

## Confianza en Instituciones y emociones frente al cambio climático
```{r confianza instituciones y emociones, fig.align='center', echo=F}
tab_tru_eco_anx <- table(data2$trust_vote_inst, data2$eco_anx)
kable(round(prop.table(tab_tru_eco_anx) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_tru_eco_anx <- data2 %>%
  ggplot(aes(x = trust_vote_inst, fill = eco_anx)) +
  geom_bar(position = "fill") +
  labs(x = "Confianza en Instituciones \n(Presidencia, Alcaldía y Congreso)", y = "Proporción", fill = "Emociones frente al \ncambio climático") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_tru_eco_anx
```

## Zona de residencia y emociones frente al cambio climático
```{r zona y emociones, fig.align='center', echo=F}
tab_zona_eco_anx <- table(data2$Zona, data2$eco_anx)
kable(round(prop.table(tab_zona_eco_anx) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_zona_eco_anx <- data2 %>%
  ggplot(aes(x = Zona, fill = eco_anx)) +
  geom_bar(position = "fill") +
  labs(x = "Zona de residencia", y = "Proporción", fill = "Emociones frente al \ncambio climático") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_zona_eco_anx
```

## Rango de edad y emociones frente al cambio climático
```{r edad y emociones, fig.align='center', echo=F}
tab_age_eco_anx <- table(data2$age_r, data2$eco_anx)
kable(round(prop.table(tab_age_eco_anx) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_age_eco_anx <- data2 %>%
  ggplot(aes(x = age_r, fill = eco_anx)) +
  geom_bar(position = "fill") +
  labs(x = "Rango de edad", y = "Proporción", fill = "Emociones frente al \ncambio climático") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_age_eco_anx
```

## Nivel educativo y origen del cambio climático
```{r relación origen cambio climatico y educacion, fig.align='center', echo=F}
tab_ori_edu <- table(data2$education, data2$clim_origin)
kable(round(prop.table(tab_ori_edu) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_ori_edu <- data2 %>%
  ggplot(aes(x = education, fill = clim_origin)) +
  geom_bar(position = "fill") +
  labs(x = "Nivel educativo alcanzado", y = "Proporción", fill = "Origen humano del \nCambio climático") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_ori_edu
```

## Rango de edad y origen del cambio climático
```{r relación origen cambio climatico y edad, fig.align='center', echo=F}
tab_ori_age <- table(data2$age_r, data2$clim_origin)
kable(round(prop.table(tab_ori_age) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_ori_age <- data2 %>%
  ggplot(aes(x = age_r, fill = clim_origin)) +
  geom_bar(position = "fill") +
  labs(x = "Rango de edad", y = "Proporción", fill = "Origen humano del \nCambio climático") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_ori_age
```

## Opinión impacto de los científicos y origen del cambio climático
```{r relación origen cambio climatico y opinion cientificos, fig.align='center', echo=F}
tab_ori_sci <- table(data2$imp_scien, data2$clim_origin)
kable(round(prop.table(tab_ori_sci) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_ori_sci <- data2 %>%
  ggplot(aes(x = imp_scien, fill = clim_origin)) +
  geom_bar(position = "fill") +
  labs(x = "Impacto científicos en el \ncambio climático", y = "Proporción", fill = "Origen humano del \nCambio climático") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_ori_sci
```

## Disposición a tomar acciones individuales y origen del cambio climático
```{r relación origen cambio climatico y disposición a actuar, fig.align='center', echo=F}
tab_ori_dis <- table(data2$dis_act, data2$clim_origin)
kable(round(prop.table(tab_ori_dis) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_ori_dis <- data2 %>%
  ggplot(aes(x = dis_act, fill = clim_origin)) +
  geom_bar(position = "fill") +
  labs(x = "Disposición a actuar frente \nal cambio climático", y = "Proporción", fill = "Origen humano del \nCambio climático") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_ori_dis
```

## Pensamientos frente al cambio climático y origen del cambio climático
```{r relación origen cambio climatico y pensamientos sobre cambio climatico, fig.align='center', echo=F}
tab_ori_th <- table(data2$thoughts, data2$clim_origin)
kable(round(prop.table(tab_ori_th) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_ori_th <- data2 %>%
  ggplot(aes(x = thoughts, fill = clim_origin)) +
  geom_bar(position = "fill") +
  labs(x = "Pensamientos frente al cambio climático", y = "Proporción", fill = "Origen humano del \nCambio climático") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_ori_th
```

## Uso de internet como fuente de información y origen del cambio climático
```{r relación origen cambio climatico e internet, fig.align='center', echo=F}
tab_ori_int <- table(data2$Internet, data2$clim_origin)
kable(round(prop.table(tab_ori_int) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_ori_int <- data2 %>%
  ggplot(aes(x = Internet, fill = clim_origin)) +
  geom_bar(position = "fill") +
  labs(x = "Internet como \nfuente de información", y = "Proporción", fill = "Origen humano del \nCambio climático") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_ori_int
```

## Zona de residencia y origen del cambio climático
```{r relación origen cambio climatico y zona, fig.align='center', echo=F}
tab_ori_zona <- table(data2$Zona, data2$clim_origin)
kable(round(prop.table(tab_ori_zona) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_ori_zona <- data2 %>%
  ggplot(aes(x = Zona, fill = clim_origin)) +
  geom_bar(position = "fill") +
  labs(x = "Zona de residencia", y = "Proporción", fill = "Origen humano del \nCambio climático") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_ori_zona
```

## Ideología política y origen del cambio climático
```{r relación origen cambio climatico e ideología, fig.align='center', echo=F}
tab_ori_ide <- table(data2$ideology, data2$clim_origin)
kable(round(prop.table(tab_ori_ide) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_ori_ide <- data2 %>%
  ggplot(aes(x = ideology, fill = clim_origin)) +
  geom_bar(position = "fill") +
  labs(x = "Ideología política", y = "Proporción", fill = "Origen humano del \nCambio climático") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_ori_ide
```

## Confianza en Instituciones y origen del cambio climático
```{r relación origen cambio climatico y confianza en instituciones, fig.align='center', echo=F}
tab_ori_tru <- table(data2$trust_vote_inst, data2$clim_origin)
kable(round(prop.table(tab_ori_tru) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_ori_tru <- data2 %>%
  ggplot(aes(x = trust_vote_inst, fill = clim_origin)) +
  geom_bar(position = "fill") +
  labs(x = "Confianza en Instituciones \n(Presidencia, Alcaldía y Congreso)", y = "Proporción", fill = "Origen humano del \nCambio climático") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_ori_tru
```


# Tests de chi-cuadrado
Se realizaron múltiples test de chi-cuadrado para establecer si existen relaciones significativas entre las principales variables de interés y las demás variables. Dado el alto número de tests se utilizó la corrección propuesta por Benjamini y Hochberg.

## Tests para la variable origen del cambio climático
```{r chi-square origen cambio climatico, echo=FALSE}
specific_variable <- "clim_origin"
variables_to_exclude <- c("C36_1", "C36_2", "C36_3", "C36_4", "C36_5", "C36_6", "C36_7", "C36_8", "C36_9", "C36_10", "C36_11", "C36_12", "C36_13", "C36_14", "C36_15", "C36_16")

# Create an empty list to store the p-values
p_values <- list()

# Create vectors to store the names of significant variables and their corresponding p-values
significant_variables <- c()
significant_p_values <- c()

for (var in names(data2)) {
  if (var != specific_variable && !(var %in% variables_to_exclude)) {
    # Create a contingency table
    contingency_table <- table(data2[[var]], data2[[specific_variable]])

    # Perform chi-square test
    chi_square <- chisq.test(contingency_table)

    # Store the raw p-value
    p_value <- chi_square$p.value
    
    # Store the p-value in the list
    p_values[[var]] <- p_value
    
  }
}

# Apply the correction for multiple comparisons to the p-values
adjusted_p_values <- p.adjust(unlist(p_values), method = "fdr")

# Loop through each variable and its corresponding p-value
for (i in seq_along(p_values)) {
  var <- names(p_values[i])
  p_value <- adjusted_p_values[i]
  
  # Check if the p-value is significant
  if (p_value < 0.05) {
    # Add the variable name to the vector
    significant_variables <- c(significant_variables, var)
    # Add the corrected p-value to the vector
    significant_p_values <- c(significant_p_values, p_value)
  }
}

# Print the names of the significant variables
sig_var <- c("Edad", "Estrato", "Etnia", "Ideología", "Internet", "Confianza Instituciones", "Emociones cambio climático", "Impacto científicos", "Impacto activistas", "Impacto grupos religiosos", "Impacto políticos", "Pensamientos cambio climático", "Disposición a actuar", "Contribución cambio climático")
# Print the significant p-values

significant_p_values <- unname(significant_p_values)
table <- data.frame(sig_var, significant_p_values)
kable(table, col.names = c("Variable", "P-value"))
```


## Tests para la variable emociones frente al cambio climático
```{r chi-square emociones cambio climatico, echo=FALSE}
specific_variable <- "eco_anx"
variables_to_exclude <- c("C36_1", "C36_2", "C36_3", "C36_4", "C36_5", "C36_6", "C36_7", "C36_8", "C36_9", "C36_10", "C36_11", "C36_12", "C36_13", "C36_14", "C36_15", "C36_16")

# Create an empty list to store the p-values
p_values <- list()

# Create vectors to store the names of significant variables and their corresponding p-values
significant_variables <- c()
significant_p_values <- c()

for (var in names(data2)) {
  if (var != specific_variable && !(var %in% variables_to_exclude)) {
    # Create a contingency table
    contingency_table <- table(data2[[var]], data2[[specific_variable]])

    # Perform chi-square test
    chi_square <- chisq.test(contingency_table)

    # Store the raw p-value
    p_value <- chi_square$p.value
    
    # Store the p-value in the list
    p_values[[var]] <- p_value
    
  }
}

# Apply the correction for multiple comparisons to the p-values
adjusted_p_values <- p.adjust(unlist(p_values), method = "fdr")

# Loop through each variable and its corresponding p-value
for (i in seq_along(p_values)) {
  var <- names(p_values[i])
  p_value <- adjusted_p_values[i]
  
  # Check if the p-value is significant
  if (p_value < 0.05) {
    # Add the variable name to the vector
    significant_variables <- c(significant_variables, var)
    # Add the corrected p-value to the vector
    significant_p_values <- c(significant_p_values, p_value)
  }
}

# Print the names of the significant variables
sig_var <- c("Ideología", "Internet", "Confianza Instituciones", "Impacto grupos religiosos", "Pensamientos cambio climático", "Disposición a actuar", "Origen cambio climático")
# Print the significant p-values

significant_p_values <- unname(significant_p_values)
table <- data.frame(sig_var, significant_p_values)
kable(table, col.names = c("Variable", "P-value"))
```


# Calculo de multiples Cramér's V
Se calcularon los tamaños del efecto de las distintas asociaciones entre las principales variables de interés y las demás variables. La medida del tamaño del efecto utilizada fue Cramér's V.

## Valores para la variable origen del cambio climático
```{r cramers v origen cambio climatico, echo=FALSE}
specific_variable <- "clim_origin"
variables_to_include <- c("age_r","estrato", "ethni", "ideology", "Internet", "trust_vote_inst", "eco_anx", "imp_scien", "imp_act", "imp_rel", "imp_pol", "thoughts", "dis_act", "cont_clim")

# Create an empty list to store the adjusted p-values
cram_values <- list()

# Loop through each variable in your dataset
for (var in variables_to_include) {
  # Create a contingency table
  contingency_table <- table(data2[[var]], data2[[specific_variable]])

    # Perform cramers_v
    cramers <- effectsize::cramers_v(contingency_table)
    
    cram_values[[var]] <- cramers$Cramers_v_adjusted
  }
# Print the adjusted Cramér's V values
cram_values <- unlist(cram_values)

sig_var <- c("Edad", "Estrato", "Etnia", "Ideología", "Internet", "Confianza Instituciones", "Emociones cambio climático", "Impacto científicos", "Impacto activistas", "Impacto grupos religiosos", "Impacto políticos", "Pensamientos cambio climático", "Disposición a actuar", "Contribución cambio climático")

cram_values <- unname(cram_values)
table <- data.frame(sig_var, cram_values)
kable(table, col.names = c("Variable", "Cramér's V"))
```


## Valores para la variable  emociones frente al cambio climático
```{r cramers v emociones cambio climático, echo=FALSE}
specific_variable <- "eco_anx"
variables_to_include <- c("ideology", "Internet", "trust_vote_inst", "imp_rel", "thoughts", "dis_act", "clim_origin")

# Create an empty list to store the adjusted p-values
cram_values <- list()

# Loop through each variable in your dataset
for (var in variables_to_include) {
  # Create a contingency table
  contingency_table <- table(data2[[var]], data2[[specific_variable]])

    # Perform cramers_v
    cramers <- effectsize::cramers_v(contingency_table)
    
    cram_values[[var]] <- cramers$Cramers_v_adjusted
  }
# Print the adjusted Cramér's V values
cram_values <- unlist(cram_values)

sig_var <- c("Ideología", "Internet", "Confianza Instituciones", "Impacto grupos religiosos", "Pensamientos cambio climático", "Disposición a actuar", "Origen cambio climático")

cram_values <- unname(cram_values)
table <- data.frame(sig_var, cram_values)
kable(table, col.names = c("Variable", "Cramér's V"))
```



# Relación variables con nueva variable para emociones frente al cambio climático
Los análisis anteriores se realizaron nuevamente pero modificando la variable de las emociones frente al cambio climático, incluyendo esta vez la clasificación basada en el modelo "Circumplex model of affect".
```{r data frame variables categoricas 2, include=FALSE}
data2 <- data1 %>%
  select(Zona, sex, age_r, estrato, ethni, education, edu, kids, ideology, Internet, trust_vote_inst, cir_mod, imp_scien, imp_act, imp_rel, imp_pol, thoughts, dis_act, clim_origin, cont_clim)

data3 <- data1 %>%
  select(Zona, sex, age_r, strat, ethni, edu, kids, ideology, Internet, trust_vote_inst, cir_mod, imp_sci, imp_ac, imp_re, imp_po, thoughts, dis_act, clim_origin, cont_clim)
# Not included: Negative emotions towards government actions against climate change, Alternative media

codigo <- c("Zona", "sex", "age_r", "strat", "ethni", "edu", "kids", "ideology", "Internet", "trust_vote_inst", "cir_mod", "imp_sci", "imp_ac", "imp_re", "imp_po", "thoughts", "dis_act", "clim_origin", "cont_clim")
descripcion <- c("Zona de residencia", "Sexo", "Rango de edad", "Estrato socioeconómico", "Pertenece a alguna etnia", "Tiene estudios de educación superior", "Tiene hijos", "Ideología política", "Se informa a través de internet", "Confía en las instituciones con cargos de elección popular", "Emociones frente al cambio climático", "Impacto de los científicos frente al cambio climático", "Impacto de activistas frente al cambio climático", "Impacto de grupos religiosos frente al cambio climático", "Impacto de políticos frente al cambio climático", "Pensamientos frente al cambio climático", "Disposición actuar cambio climático", "Causa u origen del cambio climático", "Factor que más contribuye al cambio climático")
table_vars <- data.frame(codigo, descripcion)
kable(table_vars, col.names = c("Código de la variable", "Descripción de la variable"), booktabs = TRUE)

result <- data.frame(Variable = character(), Category = character(), Frequency = integer(), stringsAsFactors = FALSE)

# Loop through each variable and compute frequencies
for (var in names(data3)) {
  freq_table <- table(data3[[var]])  # Compute frequencies
  var_result <- data.frame(Variable = var, Category = names(freq_table), Frequency = as.vector(freq_table))  # Convert table to data frame
  result <- rbind(result, var_result)  # Append to the result data frame
}
# Print the resulting data frame
kable(result, col.names = c("Variable", "Categoría", "Frecuencia"), booktabs = TRUE)
```

## Análisis de correspondencia múltiple
```{r análisis de componentes múltiples nueva variable emociones, echo=FALSE}
res.mca <- MCA(data3, graph = FALSE)
fviz_eig(res.mca, addlabels = TRUE, title = "Inertia of MCA Dimensions")
fviz_mca_ind(res.mca, geom = "point", pointsize = 2, repel = TRUE)
#fviz_mca_biplot(res.mca, geom.ind = "point", repel = TRUE, alpha.ind = 0.1)
fviz_mca_var(res.mca, choice = "var.cat", repel = TRUE)
fviz_mca_var(res.mca, choice = "var", repel = TRUE)
#summary(res.mca, ncp = 2, nbelements = Inf)
fviz(res.mca, element = "ind", geom = "point", pointsize = 2, hab = "cir_mod", alpha = 0.2)
fviz(res.mca, element = "ind", geom = "point", pointsize = 2, hab = "clim_origin", alpha = 0.2)
fviz(res.mca, element = "ind", geom = "point", pointsize = 2, hab = "dis_act", alpha = 0.2)
fviz(res.mca, element = "ind", geom = "point", pointsize = 2, hab = "Internet", alpha = 0.2)
dimdesc(res.mca, axes = 1:2)
```


## Análisis con las variables sociodemográficas como variables suplementarias
```{r análisis de componentes múltiples 2 nueva variable emociones, echo=FALSE}
res.mca <- MCA(data3, quali.sup = c(1:7), graph = FALSE)
fviz_eig(res.mca, addlabels = TRUE, title = "Inertia of MCA Dimensions")
fviz_mca_ind(res.mca, geom = "point", pointsize = 2, repel = TRUE)
#fviz_mca_biplot(res.mca, geom.ind = "point", repel = TRUE, alpha.ind = 0.1)
fviz_mca_var(res.mca, choice = "var.cat", repel = TRUE)
fviz_mca_var(res.mca, choice = "var", repel = TRUE)
#summary(res.mca, ncp = 2, nbelements = Inf)
fviz(res.mca, element = "ind", geom = "point", pointsize = 2, hab = "cir_mod", alpha = 0.2)
fviz(res.mca, element = "ind", geom = "point", pointsize = 2, hab = "clim_origin", alpha = 0.2)
fviz(res.mca, element = "ind", geom = "point", pointsize = 2, hab = "dis_act", alpha = 0.2)
fviz(res.mca, element = "ind", geom = "point", pointsize = 2, hab = "Internet", alpha = 0.2)
dimdesc(res.mca, axes = 1:2)
```


# Exploración visual de relaciones

## Origen del cambio climático y emociones frente al cambio climático
```{r relación origen cambio climatico y emociones 2, fig.align='center', echo=F}
tab_ori_eco_anx <- table(data2$clim_origin, data2$cir_mod)
kable(round(prop.table(tab_ori_eco_anx) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_ori_eco_anx <- data2 %>%
  ggplot(aes(x = cir_mod, fill = clim_origin)) +
  geom_bar(position = "fill") +
  labs(x = "Emociones frente al \ncambio climático", y = "Proporción", fill = "Origen humano del \nCambio climático") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_ori_eco_anx
```

## Pensamientos frente al cambio climático y emociones frente al cambio climático
```{r relación pensamientos y emociones 2, fig.align='center', echo=F}
tab_th_eco_anx <- table(data2$thoughts, data2$cir_mod)
kable(round(prop.table(tab_th_eco_anx) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_th_eco_anx <- data2 %>%
  ggplot(aes(x = cir_mod, fill = thoughts)) +
  geom_bar(position = "fill") +
  labs(x = "Emociones frente al \ncambio climático", y = "Proporción", fill = "Pensamientos \nfrente al cambio climático") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_th_eco_anx
```

## Ideología política y emociones frente al cambio climático
```{r relación ideologia y emociones 2, fig.align='center', echo=F}
tab_ide_eco_anx <- table(data2$ideology, data2$cir_mod)
kable(round(prop.table(tab_ide_eco_anx) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_ide_eco_anx <- data2 %>%
  ggplot(aes(x = cir_mod, fill = ideology)) +
  geom_bar(position = "fill") +
  labs(x = "Emociones frente al \ncambio climático", y = "Proporción", fill = "Ideología política") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_ide_eco_anx
```

## Disposición a tomar acciones individuales y emociones frente al cambio climático
```{r disposicion a actuar y emociones 2, fig.align='center', echo=F}
tab_dis_eco_anx <- table(data2$dis_act, data2$cir_mod)
kable(round(prop.table(tab_dis_eco_anx) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_dis_eco_anx <- data2 %>%
  ggplot(aes(x = cir_mod, fill = dis_act)) +
  geom_bar(position = "fill") +
  labs(x = "Emociones frente al \ncambio climático", y = "Proporción", fill = "Disposición a actuar frente \nal cambio climático") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_dis_eco_anx
```

## Factor que más contribuye al cambio climático y emociones frente al cambio climático
```{r relación contribucion al cambio climatico y emociones 2, fig.align='center', echo=F}
tab_cont_eco_anx <- table(data2$cont_clim, data2$cir_mod)
kable(round(prop.table(tab_cont_eco_anx) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_cont_eco_anx <- data2 %>%
  ggplot(aes(x = cir_mod, fill = cont_clim)) +
  geom_bar(position = "fill") +
  labs(x = "Emociones frente al \ncambio climático", y = "Proporción", fill = "Quema combustibles fósiles \nmayor contribución al \ncambio climático") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_cont_eco_anx
```

## Uso de internet como fuente de información y emociones frente al cambio climático
```{r relación internet y emociones 2, fig.align='center', echo=F}
tab_int_eco_anx <- table(data2$Internet, data2$cir_mod)
kable(round(prop.table(tab_int_eco_anx) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_int_eco_anx <- data2 %>%
  ggplot(aes(x = cir_mod, fill = Internet)) +
  geom_bar(position = "fill") +
  labs(x = "Emociones frente al \ncambio climático", y = "Proporción", fill = "Internet como \nfuente de información") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_int_eco_anx
```

## Confianza en Instituciones y emociones frente al cambio climático
```{r confianza instituciones y emociones 2, fig.align='center', echo=F}
tab_tru_eco_anx <- table(data2$trust_vote_inst, data2$cir_mod)
kable(round(prop.table(tab_tru_eco_anx) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_tru_eco_anx <- data2 %>%
  ggplot(aes(x = cir_mod, fill = trust_vote_inst)) +
  geom_bar(position = "fill") +
  labs(x = "Emociones frente al \ncambio climático", y = "Proporción", fill = "Confianza en Instituciones \n(Presidencia, Alcaldía y Congreso)") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_tru_eco_anx
```

## Zona de residencia y emociones frente al cambio climático
```{r zona y emociones 2, fig.align='center', echo=F}
tab_zona_eco_anx <- table(data2$Zona, data2$cir_mod)
kable(round(prop.table(tab_zona_eco_anx) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_zona_eco_anx <- data2 %>%
  ggplot(aes(x = cir_mod, fill = Zona)) +
  geom_bar(position = "fill") +
  labs(x = "Emociones frente al \ncambio climático", y = "Proporción", fill = "Zona de residencia") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_zona_eco_anx
```

## Rango de edad y emociones frente al cambio climático
```{r edad y emociones 2, fig.align='center', echo=F}
tab_age_eco_anx <- table(data2$age_r, data2$cir_mod)
kable(round(prop.table(tab_age_eco_anx) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_age_eco_anx <- data2 %>%
  ggplot(aes(x = cir_mod, fill = age_r)) +
  geom_bar(position = "fill") +
  labs(x = "Emociones frente al \ncambio climático", y = "Proporción", fill = "Rango de edad") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_age_eco_anx
```

## Tests de Chi-cuadrado para la variable origen del cambio climático
```{r chi-square origen cambio climatico nueva variable emociones, echo=FALSE}
specific_variable <- "clim_origin"

# Create an empty list to store the p-values
p_values <- list()

# Create vectors to store the names of significant variables and their corresponding p-values
significant_variables <- c()
significant_p_values <- c()

for (var in names(data2)) {
  if (var != specific_variable) {
    # Create a contingency table
    contingency_table <- table(data2[[var]], data2[[specific_variable]])

    # Perform chi-square test
    chi_square <- chisq.test(contingency_table)

    # Store the raw p-value
    p_value <- chi_square$p.value
    
    # Store the p-value in the list
    p_values[[var]] <- p_value
    
  }
}

# Apply the correction for multiple comparisons to the p-values
adjusted_p_values <- p.adjust(unlist(p_values), method = "fdr")

# Loop through each variable and its corresponding p-value
for (i in seq_along(p_values)) {
  var <- names(p_values[i])
  p_value <- adjusted_p_values[i]
  
  # Check if the p-value is significant
  if (p_value < 0.05) {
    # Add the variable name to the vector
    significant_variables <- c(significant_variables, var)
    # Add the corrected p-value to the vector
    significant_p_values <- c(significant_p_values, p_value)
  }
}

# Print the names of the significant variables
sig_var <- c("Edad", "Estrato", "Etnia", "Ideología", "Internet", "Confianza Instituciones", "Emociones cambio climático", "Impacto científicos", "Impacto activistas", "Impacto grupos religiosos", "Impacto políticos", "Pensamientos cambio climático", "Disposición a actuar", "Contribución cambio climático")
# Print the significant p-values

significant_p_values <- unname(significant_p_values)
table <- data.frame(sig_var, significant_p_values)
kable(table, col.names = c("Variable", "P-value"))
```


## Tests de Chi-cuadrado para la variable emociones frente al cambio climático
```{r chi-square nueva variable emociones cambio climatico, echo=FALSE}
specific_variable <- "cir_mod"

# Create an empty list to store the p-values
p_values <- list()

# Create vectors to store the names of significant variables and their corresponding p-values
significant_variables <- c()
significant_p_values <- c()

for (var in names(data2)) {
  if (var != specific_variable) {
    # Create a contingency table
    contingency_table <- table(data2[[var]], data2[[specific_variable]])

    # Perform chi-square test
    chi_square <- chisq.test(contingency_table)

    # Store the raw p-value
    p_value <- chi_square$p.value
    
    # Store the p-value in the list
    p_values[[var]] <- p_value
    
  }
}

# Apply the correction for multiple comparisons to the p-values
adjusted_p_values <- p.adjust(unlist(p_values), method = "fdr")

# Loop through each variable and its corresponding p-value
for (i in seq_along(p_values)) {
  var <- names(p_values[i])
  p_value <- adjusted_p_values[i]
  
  # Check if the p-value is significant
  if (p_value < 0.05) {
    # Add the variable name to the vector
    significant_variables <- c(significant_variables, var)
    # Add the corrected p-value to the vector
    significant_p_values <- c(significant_p_values, p_value)
  }
}

# Print the names of the significant variables
sig_var <- c("Sexo", "Estrato", "Nivel educativo","Ideología", "Internet", "Confianza Instituciones", "Impacto científicos", "Impacto grupos religiosos", "Impacto políticos", "Pensamientos cambio climático", "Disposición a actuar", "Origen cambio climático", "Contribución cambio climático")
# Print the significant p-values

significant_p_values <- unname(significant_p_values)
table <- data.frame(sig_var, significant_p_values)
kable(table, col.names = c("Variable", "P-value"))
```


## Valores de Cramers' V para la variable origen del cambio climático
```{r cramers v origen cambio climatico nueva variable emociones, echo=FALSE}
specific_variable <- "clim_origin"
variables_to_include <- c("age_r","estrato", "ethni", "ideology", "Internet", "trust_vote_inst", "cir_mod", "imp_scien", "imp_act", "imp_rel", "imp_pol", "thoughts", "dis_act", "cont_clim")

# Create an empty list to store the adjusted p-values
cram_values <- list()

# Loop through each variable in your dataset
for (var in variables_to_include) {
  # Create a contingency table
  contingency_table <- table(data2[[var]], data2[[specific_variable]])

    # Perform cramers_v
    cramers <- effectsize::cramers_v(contingency_table)
    
    cram_values[[var]] <- cramers$Cramers_v_adjusted
  }
# Print the adjusted Cramér's V values
cram_values <- unlist(cram_values)

sig_var <- c("Edad", "Estrato", "Etnia", "Ideología", "Internet", "Confianza Instituciones", "Emociones cambio climático", "Impacto científicos", "Impacto activistas", "Impacto grupos religiosos", "Impacto políticos", "Pensamientos cambio climático", "Disposición a actuar", "Contribución cambio climático")

cram_values <- unname(cram_values)
table <- data.frame(sig_var, cram_values)
kable(table, col.names = c("Variable", "Cramér's V"))
```


## Valores de Cramers' V para la variable emociones frente al cambio climático
```{r cramers v nueva variable emociones cambio climático, echo=FALSE}
specific_variable <- "cir_mod"
variables_to_include <- c("sex", "estrato", "education", "ideology", "Internet", "trust_vote_inst", "imp_scien", "imp_rel", "imp_pol", "thoughts", "dis_act", "clim_origin", "cont_clim")

# Create an empty list to store the adjusted p-values
cram_values <- list()

# Loop through each variable in your dataset
for (var in variables_to_include) {
  # Create a contingency table
  contingency_table <- table(data2[[var]], data2[[specific_variable]])

    # Perform cramers_v
    cramers <- effectsize::cramers_v(contingency_table)
    
    cram_values[[var]] <- cramers$Cramers_v_adjusted
  }
# Print the adjusted Cramér's V values
cram_values <- unlist(cram_values)

sig_var <- c("Sexo", "Estrato", "Nivel educativo","Ideología", "Internet", "Confianza Instituciones", "Impacto científicos", "Impacto grupos religiosos", "Impacto políticos", "Pensamientos cambio climático", "Disposición a actuar", "Origen cambio climático", "Contribución cambio climático")

cram_values <- unname(cram_values)
table <- data.frame(sig_var, cram_values)
kable(table, col.names = c("Variable", "Cramér's V"))
```