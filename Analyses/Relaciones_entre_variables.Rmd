---
title: 'Encuesta: Relaciones entre variables'
author: "Juan Sebastian Cely"
date: "`r Sys.Date()`"
output: github_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
stopifnot(require(openxlsx), require(kableExtra), require(dm), require(dplyr), require (ggplot2), require(rms), require(caret), require(lmtest), require(car), require(yardstick), require(papaja), require(pandoc), require(tinytex), require(RColorBrewer), require(ggplotify), require(FactoMineR), require(factoextra), require(Factoshiny))
knitr::opts_chunk$set(cache=F,fig.path="./figures",cache.rebuild = F, out.width = "80%")
options(knitr.table.format = "simple")
```

```{r data, include=FALSE}
wb<-loadWorkbook("020-22 Base de Datos Anonimizada V4 (1).xlsx")
names(wb)
data1 <- readWorkbook(wb,sheet=1)
codeBook1 <- readWorkbook(wb,sheet=2,skipEmptyRows = F)
```

```{r tranformación y recodificación variables, include=FALSE}
# Eco-anxiety
neg_emo <- c("C36_1", "C36_3", "C36_4", "C36_5", "C36_6", "C36_7", "C36_8", "C36_9", "C36_10", "C36_11", "C36_15")
amb_emo <- c("C36_13")
pos_emo <- c("C36_2", "C36_12", "C36_14", "C36_16")
data1$eco_anx <- NA
for (i in 1:nrow(data1)) {
neg_emo_count <- sum(data1[i, neg_emo] == 1)
pos_emo_count <- sum(data1[i, pos_emo] == 1)
amb_emo_count <- sum(data1[i, amb_emo] == 1)
if (neg_emo_count %in% c(1, 2) & pos_emo_count == 0 & amb_emo_count == 0) {
data1$eco_anx[i] <- "Con eco-ansiedad"
} else if (neg_emo_count == 1 & pos_emo_count == 1 & amb_emo_count == 0) {
data1$eco_anx[i] <- "Ambivalente/Neutral"
} else if (neg_emo_count == 1 & pos_emo_count == 0 & amb_emo_count == 1) {
data1$eco_anx[i] <- "Ambivalente/Neutral"
} else if (neg_emo_count == 0 & pos_emo_count == 1 & amb_emo_count == 1) {
data1$eco_anx[i] <- "Ambivalente/Neutral"
} else if (neg_emo_count == 0 & pos_emo_count == 0 & amb_emo_count == 1) {
data1$eco_anx[i] <- "Ambivalente/Neutral"
} else if (neg_emo_count == 0 & pos_emo_count %in% c(1, 2) & amb_emo_count == 0) {
data1$eco_anx[i] <- "Sin eco-ansiedad"
}
}
data1$eco_anx <- factor(data1$eco_anx, levels = c("Con eco-ansiedad", "Ambivalente/Neutral", "Sin eco-ansiedad"))

# Types of eco-emotions -> eco-anxiety
neg_emo <- c("C36_5")
amb_emo <- c("C36_13")
pos_emo <- c("C36_2", "C36_12", "C36_14", "C36_16")
data1$eco_anx2 <- NA
for (i in 1:nrow(data1)) {
neg_emo_count <- sum(data1[i, neg_emo] == 1)
pos_emo_count <- sum(data1[i, pos_emo] == 1)
amb_emo_count <- sum(data1[i, amb_emo] == 1)
if (neg_emo_count == 1 & pos_emo_count == 0 & amb_emo_count == 0) {
data1$eco_anx2[i] <- "Con eco-ansiedad"
} else if (neg_emo_count == 1 & pos_emo_count == 1 & amb_emo_count == 0) {
data1$eco_anx2[i] <- "Ambivalente/Neutral"
} else if (neg_emo_count == 1 & pos_emo_count == 0 & amb_emo_count == 1) {
data1$eco_anx2[i] <- "Ambivalente/Neutral"
} else if (neg_emo_count == 0 & pos_emo_count == 1 & amb_emo_count == 1) {
data1$eco_anx2[i] <- "Ambivalente/Neutral"
} else if (neg_emo_count == 0 & pos_emo_count == 0 & amb_emo_count == 1) {
data1$eco_anx2[i] <- "Ambivalente/Neutral"
} else if (neg_emo_count == 0 & pos_emo_count %in% c(1, 2) & amb_emo_count == 0) {
data1$eco_anx2[i] <- "Sin eco-ansiedad"
} else if (neg_emo_count == 0 & pos_emo_count == 0 & amb_emo_count == 0) {
data1$eco_anx2[i] <- "Sin eco-ansiedad"
}
}
data1$eco_anx2 <- factor(data1$eco_anx2, levels = c("Con eco-ansiedad", "Ambivalente/Neutral", "Sin eco-ansiedad"))


# Residential area
data1$Zona <- as.factor(data1$Zona)

# Sex
data1$A1 <- as.factor(data1$A1)
levels(data1$A1) <- c("Hombre", "Mujer")
data1$sex <- data1$A1

# Age range
data1$RANGO_EDAD <- as.factor(data1$RANGO_EDAD)
data1$age_r <- data1$RANGO_EDAD
data1 <- data1 %>%
  mutate(age_r = case_when(
    age_r == 1 ~ "De 18 a 20 años",
    age_r == 2 ~ "De 21 a 24 años",
    age_r == 3 ~ "De 25 a 29 años",
    age_r == 4 ~ "De 30 a 32 años"
))
data1$age_r <- as.factor(data1$age_r)
data1$edad <- data1$A2

# Stratum
data1$estrato <- as.factor(data1$A3)
data1$strat <- data1$A3
data1 <- data1 %>%
  mutate(strat = case_when(
    strat %in% c(1,2) ~ "Bajo",
    strat %in% c(3,4) ~ "Medio",
    strat %in% c(5,6) ~ "Alto"
))
data1$strat <- factor(data1$strat, levels = c("Bajo", "Medio", "Alto"))

# Ethnics
data1$A5 <- as.factor(data1$A5)
levels(data1$A5) <- c("Indígena", "Gitana(o) Rrom", "Raizal", "Palenquera(o)", "Afro", "Ninguna")
data1$ethni <- data1$A5
data1 <- data1 %>%
  mutate(ethni = case_when(
    ethni != "Ninguna" ~ "Sí",
    ethni == "Ninguna" ~ "No"
))
data1$ethni <- as.factor(data1$ethni)

# Education
data1$education <- as.factor(data1$A6)
levels(data1$education) <- c("Básica Primaria", "Básica Secundaria", "Secundaria Completa", "Técnico o Tecnólogo", "Pregrado", "Posgrado")

data1 <- data1 %>%
  mutate(edu = case_when(
    education %in% c("Básica Primaria", "Básica Secundaria", "Secundaria Completa", "Técnico o Tecnólogo") ~ "No",
    education %in% c("Pregrado", "Posgrado") ~ "Sí"
))
data1$edu <- as.factor(data1$edu)

# Kids
data1$A9 <- as.factor(data1$A9)
levels(data1$A9) <- c("Sí", "No")
data1$kids <- data1$A9

# Political ideology
data1$A11 <- as.factor(data1$A11)
data1 <- data1 %>%
  mutate(ideology = case_when(
    A11 %in% c(1, 2) ~ "Izquierda",
    A11 %in% c(3, 4) ~ "Centro",
    A11 %in% c(5, 6) ~ "Derecha"
  ))
data1$ideology <- factor(data1$ideology, levels = c("Derecha", "Centro", "Izquierda"))

# Information sources
data1 <- data1 %>%
  rename(Televisión = B12_1,
         Radio = B12_2,
         Prensa_Impresa = B12_3,
         Medios_Digitales = B12_4,
         Redes_Sociales = B12_5,
         Otro_medio = B12_89)

vars_to_convert <- c("Televisión",
         "Radio",
         "Prensa_Impresa",
         "Medios_Digitales",
         "Redes_Sociales",
         "Otro_medio")

for (var in vars_to_convert) {
  data1[[var]] <- factor(data1[[var]])
}
new_levels <- c("No", "Sí")
for (var in vars_to_convert) {
  levels(data1[[var]]) <- new_levels
}

data1 <- data1 %>%
  mutate(Internet = case_when(
    Medios_Digitales == "Sí" & Redes_Sociales == "Sí" ~ "Sí",
    Medios_Digitales == "Sí" & Redes_Sociales == "No" ~ "Sí",
    Medios_Digitales == "No" & Redes_Sociales == "Sí" ~ "Sí",
    Medios_Digitales == "No" & Redes_Sociales == "No" ~ "No"
  ))
data1$Internet <- as.factor(data1$Internet)

# Trust in particular Institutions and figures
trust_vote_inst <- data1 %>%
  select(C17_5, C17_7, C17_8)
trust_vote_inst[] <- lapply(trust_vote_inst, function(x) replace(x, x == 2, -1))
trust_vote_inst[] <- lapply(trust_vote_inst, function(x) replace(x, x == 3, 0))
data1$trust_vote_inst <- rowSums(trust_vote_inst)
data1$trust_vote_inst <- as.factor(data1$trust_vote_inst)

data1 <- data1 %>%
  mutate(trust_vote_inst = case_when(
    trust_vote_inst %in% c("-3", "-2", "-1") ~ "No",
    trust_vote_inst == "0"  ~ "Neutral",
    trust_vote_inst %in% c("1", "2", "3") ~ "Sí"
  ))
data1$trust_vote_inst <- as.factor(data1$trust_vote_inst)

#trust_unis <- data1 %>%
  #select(C17_14, C17_15)
#trust_unis[] <- lapply(trust_unis, function(x) replace(x, x == 2, -1))
#trust_unis[] <- lapply(trust_unis, function(x) replace(x, x == 3, 0))
#data1$trust_unis <- rowSums(trust_unis)
#data1$trust_unis <- as.factor(data1$trust_unis)

# Join an environmental organization
data1$C18_7 <- as.factor(data1$C18_7)
levels(data1$C18_7) <- c("Sí", "No")
data1$env_aso <- data1$C18_7

# Negative emotions towards actions taken by the government regarding climate change
neg_d34 <- c("D34_2", "D34_3", "D34_4", "D34_6", "D34_8", "D34_9")
pos_d34 <- c("D34_1", "D34_5", "D34_7", "D34_10")
data1$neg_emo_gov <- NA
for (i in 1:nrow(data1)) {
  data1$neg_emo_gov[i] <- sum(data1[i, neg_d34]) - sum(data1[i, pos_d34]) + 19
}

# Impact of scientists on climate change
data1$imp_scien <- data1$D35_1
data1$imp_scien[data1$imp_scien == 99] <- 3.5
value_mapping <- c(1, 2, 3, 3.5, 4, 5, 6)
new_values <- c(-3, -2, -1, 0, 1, 2, 3)
data1$imp_scien <- new_values[match(data1$imp_scien, value_mapping)]
data1$imp_scien <- as.factor(data1$imp_scien)

data1 <- data1 %>%
  mutate(imp_scien = case_when(
    imp_scien %in% c("-3", "-2", "-1") ~ "Negativo",
    imp_scien == "0"  ~ "No sabe",
    imp_scien %in% c("1", "2", "3") ~ "Positivo"
  ))
data1$imp_scien <- as.factor(data1$imp_scien)

# Impact of activists on climate change
data1$imp_act <- data1$D35_7
data1$imp_act[data1$imp_act == 99] <- 3.5
value_mapping <- c(1, 2, 3, 3.5, 4, 5, 6)
new_values <- c(-3, -2, -1, 0, 1, 2, 3)
data1$imp_act <- new_values[match(data1$imp_act, value_mapping)]
data1$imp_act <- as.factor(data1$imp_act)

data1 <- data1 %>%
  mutate(imp_act = case_when(
    imp_act %in% c("-3", "-2", "-1") ~ "Negativo",
    imp_act == "0"  ~ "No sabe",
    imp_act %in% c("1", "2", "3") ~ "Positivo"
  ))
data1$imp_act <- as.factor(data1$imp_act)

# Impact of religious groups on climate change
data1$imp_rel <- data1$D35_3
data1$imp_rel[data1$imp_rel == 99] <- 3.5
value_mapping <- c(1, 2, 3, 3.5, 4, 5, 6)
new_values <- c(-3, -2, -1, 0, 1, 2, 3)
data1$imp_rel <- new_values[match(data1$imp_rel, value_mapping)]
data1$imp_rel <- as.factor(data1$imp_rel)

data1 <- data1 %>%
  mutate(imp_rel = case_when(
    imp_rel %in% c("-3", "-2", "-1") ~ "Negativo",
    imp_rel == "0"  ~ "No sabe",
    imp_rel %in% c("1", "2", "3") ~ "Positivo"
  ))
data1$imp_rel <- as.factor(data1$imp_rel)

# Impact of politicians on climate change
data1$imp_pol <- data1$D35_6
data1$imp_pol[data1$imp_pol == 99] <- 3.5
value_mapping <- c(1, 2, 3, 3.5, 4, 5, 6)
new_values <- c(-3, -2, -1, 0, 1, 2, 3)
data1$imp_pol <- new_values[match(data1$imp_pol, value_mapping)]
data1$imp_pol <- as.factor(data1$imp_pol)

data1 <- data1 %>%
  mutate(imp_pol = case_when(
    imp_pol %in% c("-3", "-2", "-1") ~ "Negativo",
    imp_pol == "0"  ~ "No sabe",
    imp_pol %in% c("1", "2", "3") ~ "Positivo"
  ))
data1$imp_pol <- as.factor(data1$imp_pol)

# Thoughts about climate change
pos_thought <- c("C37_9", "C37_11", "C37_12", "C37_13", "C37_15")
neg_thought<- c("C37_1", "C37_2", "C37_4", "C37_5", "C37_6", "C37_7", "C37_8", "C37_14")
neut_thought <- c("C37_3", "C37_10")
data1$thoughts <- NA
for (i in 1:nrow(data1)) {
neg_th_count <- sum(data1[i, neg_thought] == 1)
pos_th_count <- sum(data1[i, pos_thought] == 1)
amb_th_count <- sum(data1[i, neut_thought] == 1)
if (neg_th_count %in% c(1, 2, 3) & pos_th_count == 0 & amb_th_count == 0) {
data1$thoughts[i] <- "Negativos"
} else if (neg_th_count == 2 & pos_th_count == 1 & amb_th_count == 0) {
data1$thoughts[i] <- "Ambivalentes/Neutrales"
} else if (neg_th_count == 2 & pos_th_count == 0 & amb_th_count == 1) {
data1$thoughts[i] <- "Ambivalentes/Neutrales"
} else if (neg_th_count == 1 & pos_th_count == 1 & amb_th_count == 1) {
data1$thoughts[i] <- "Ambivalentes/Neutrales"
} else if (neg_th_count == 1 & pos_th_count == 1 & amb_th_count == 0) {
data1$thoughts[i] <- "Ambivalentes/Neutrales"
} else if (neg_th_count == 1 & pos_th_count == 0 & amb_th_count == 1) {
data1$thoughts[i] <- "Ambivalentes/Neutrales"
} else if (neg_th_count == 0 & pos_th_count %in% c(1, 2, 3) & amb_th_count == 0) {
data1$thoughts[i] <- "Positivos"
} else if (neg_th_count == 1 & pos_th_count == 2 & amb_th_count == 0) {
data1$thoughts[i] <- "Ambivalentes/Neutrales"
} else if (neg_th_count == 0 & pos_th_count == 2 & amb_th_count == 1) {
data1$thoughts[i] <- "Ambivalentes/Neutrales"
} else if (neg_th_count == 0 & pos_th_count == 1 & amb_th_count == 1) {
data1$thoughts[i] <- "Ambivalentes/Neutrales"
} else if (neg_th_count == 0 & pos_th_count == 0 & amb_th_count %in% c(1, 2)) {
data1$thoughts[i] <- "Ambivalentes/Neutrales"
} else if (neg_th_count == 1 & pos_th_count == 0 & amb_th_count == 2) {
data1$thoughts[i] <- "Ambivalentes/Neutrales"
} else if (neg_th_count == 0 & pos_th_count == 1 & amb_th_count == 2) {
data1$thoughts[i] <- "Ambivalentes/Neutrales"
}
}
data1$thoughts <- factor(data1$thoughts, levels = c("Negativos", "Ambivalentes/Neutrales", "Positivos"))

# Impact of individual actions on comfort
c38 <- grep("^C38_", names(data1), value=T)
data1$imp_como <- NA
for (i in 1:nrow(data1)) {
  data1$imp_como[i] <- round(sum(data1[i, c38]) / 10) 
}
data1$imp_como <- as.factor(data1$imp_como)
levels(data1$imp_como) <- c("-3", "-2", "-1", "1", "2", "3")

data1 <- data1 %>%
  mutate(imp_como = case_when(
    imp_como %in% c("-3", "-2", "-1") ~ "Negativo",
    imp_como %in% c("1", "2", "3") ~ "Positivo"
  ))
data1$imp_como <- as.factor(data1$imp_como)

# Impact of individual actions on climate change
c39 <- grep("^C39_", names(data1), value=T)
data1$imp_cli <- NA
for (i in 1:nrow(data1)) {
  data1$imp_cli[i] <- round(sum(data1[i, c39]) / 10)
}
data1$imp_cli <- as.factor(data1$imp_cli)
levels(data1$imp_cli) <- c("-3", "-2", "-1", "1", "2", "3")

data1 <- data1 %>%
  mutate(imp_cli = case_when(
    imp_cli %in% c("-3", "-2", "-1") ~ "Negativo",
    imp_cli %in% c("1", "2", "3") ~ "Positivo"
  ))
data1$imp_cli <- as.factor(data1$imp_cli)

# Climate change origin
data1$C40 <- as.factor(data1$C40)
data1 <- data1 %>%
  mutate(clim_ori = case_when(
    C40 %in% c(1,2) ~ "0 a 20%",
    C40 %in% c(3,4) ~ "20 a 40%",
    C40 %in% c(5,6) ~ "40 a 60%",
    C40 %in% c(7,8) ~ "60 a 80%",
    C40 %in% c(9,10) ~ "80 a 100%"
    ))
data1$clim_ori <- as.factor(data1$clim_ori)

# Climate change origin extremes
data1$C40 <- as.factor(data1$C40)
data1 <- data1 %>%
  mutate(clim_origin = case_when(
    C40 == 1 ~ "Totalmente natural",
    C40 %in% c(2,3) ~ "Mayoritariamente natural",
    C40 %in% c(4,5) ~ "Algo más natural",
    C40 %in% c(6,7) ~ "Algo más humano",
    C40 %in% c(8,9) ~ "Mayoritariamente humano",
    C40 == 10 ~ "Totalmente humano"
    ))
data1$clim_origin <- as.factor(data1$clim_origin)
data1$clim_origin <- factor(data1$clim_origin, levels = c("Totalmente natural", "Mayoritariamente natural", "Algo más natural", "Algo más humano", "Mayoritariamente humano", "Totalmente humano"))

# Contribution to climate change
data1$C41 <- as.factor(data1$C41)
data1 <- data1 %>%
  mutate(cont_clim = case_when(
    C41 %in% c(1, 3, 4) ~ "Incorrecta",
    C41 == 2 ~ "Correcta"
))
data1$cont_clim <- as.factor(data1$cont_clim)
```

```{r data frames para variables continuas y variables categoricas, include=FALSE}
data2 <- data1 %>%
  select(Zona, sex, edad, estrato, ethni, education, kids, ideology, Televisión, Radio, Prensa_Impresa, Medios_Digitales, Redes_Sociales, trust_vote_inst, eco_anx2, env_aso, imp_scien, imp_act, imp_rel, imp_pol, thoughts, imp_como, imp_cli, clim_ori, cont_clim)
# Not included: Negative emotions towards government actions against climate change, Alternative media
```

Una diagonal que va desde la esquina superior izquierda hasta la esquina inferior derecha parece separar individuos que no parecen presentar preocupación por el cambio climático y que no entienden bien su origen y lo que podemos hacer frente a él de aquellos que sienten preocupación por este fenomeno al entender su origen en la actividad humana y que consideran que es posible hacer algo frente a él de manera individual. Así, la variabilidad entre individuos puede entenderse en cierta medida a partir de esta diagonal.
```{r análisis de componentes múltiples}
result <- data.frame(Variable = character(), Category = character(), Frequency = integer(), stringsAsFactors = FALSE)

# Loop through each variable and compute frequencies
for (var in names(data2)) {
  freq_table <- table(data2[[var]])  # Compute frequencies
  var_result <- data.frame(Variable = var, Category = names(freq_table), Frequency = as.vector(freq_table))  # Convert table to data frame
  result <- rbind(result, var_result)  # Append to the result data frame
}
# Print the resulting data frame
print(result)

res.mca <- MCA(data2, graph = FALSE, quanti.sup = 3)
fviz_eig(res.mca, addlabels = TRUE, title = "Inertia of MCA Dimensions")
fviz_mca_ind(res.mca, geom = "point", pointsize = 2, repel = TRUE)
fviz_mca_ind(res.mca, geom = "point", pointsize = 2, hab = "eco_anx2", addEllipses = TRUE, alpha = 0.2)
fviz(res.mca, element = "ind", geom = "point", pointsize = 2, hab = "clim_ori", addEllipses = TRUE, alpha = 0.2)
fviz_mca_biplot(res.mca, geom.ind = "point", repel = TRUE, alpha.ind = 0.1)
fviz_mca_var(res.mca, choice = "var.cat", repel = TRUE)
fviz_mca_var(res.mca, choice = "var", repel = TRUE)
summary(res.mca, ncp = 3, nbelements = Inf)
dimdesc(res.mca)
plot(res.mca, invisible = "var", cex = 0.7, label = "none", hab = "clim_ori", select = 0)
plot(res.mca, invisible = "ind", autoLab = "y", cex = 0.7)
plot(res.mca, invisible = c("ind", "quali.sup"), autoLab = "y", cex = 0.7)
plot(res.mca, invisible = "ind", autoLab = "y", cex = 0.7, selectMod = "contrib 20")
```


```{r análisis de componentes múltiples 2, include=FALSE, eval=FALSE}
res.mca <- MCA(data2, quali.sup = c(17:20), quanti.sup = 3, graph = FALSE)
fviz_eig(res.mca, addlabels = TRUE, title = "Inertia of MCA Dimensions")
fviz_mca_ind(res.mca, geom = "point", pointsize = 2)
fviz_mca_ind(res.mca, geom = "point", pointsize = 2, hab = "clim_ori")
fviz(res.mca, element = "ind", geom = "point", pointsize = 2, hab = "clim_ori", alpha = 0.2)
fviz_mca_biplot(res.mca, geom.ind = "point", repel = TRUE, alpha.ind = 0.1)
fviz_mca_var(res.mca, choice = "var.cat", repel = TRUE)
fviz_mca_var(res.mca, choice = "var", repel = TRUE)
summary(res.mca, ncp = 3, nbelements = Inf)
dimdesc(res.mca)
```


```{r análisis de componentes múltiples 3, include=FALSE, eval=FALSE}
res.mca <- MCA(data2, quali.sup = c(17:20, 4:14, 1:2), graph = FALSE , quanti.sup = 3)
fviz_eig(res.mca, addlabels = TRUE, title = "Inertia of MCA Dimensions")
fviz_mca_ind(res.mca, geom = "point", pointsize = 2)
fviz_mca_ind(res.mca, geom = "point", pointsize = 2, hab = "clim_ori")
fviz(res.mca, element = "ind", geom = "point", pointsize = 2, hab = "clim_ori", alpha = 0.2)
fviz_mca_biplot(res.mca, geom.ind = "point", repel = TRUE, alpha.ind = 0.1)
fviz_mca_var(res.mca, choice = "var.cat", repel = TRUE)
summary(res.mca, ncp = 3, nbelements = Inf)
dimdesc(res.mca)
```


```{r analisis de variables continuas, eval=FALSE, include=FALSE}
# Correlation matrix
cor_matrix <- round(cor(data2[, sapply(data2, is.numeric)]), 2)
kable(cor_matrix)

corrplot::corrplot(cor(data2[, sapply(data2, is.numeric)]), diag = FALSE)

# PCA
res.pca <- PCA(data2[, sapply(data2, is.numeric)])
kable(res.pca$eig) # Percentage of variance: Better than variables by themselves
fviz_eig(res.pca, addlabels = TRUE)
corrplot::corrplot(res.pca$var$coord) # Correlation of each variable with the components
fviz_contrib(res.pca, choice = "var")
fviz_contrib(res.pca, choice = "var", axes = 2)
fviz_pca_ind(res.pca, col.ind = data2$eco_anx, label = "point")
```

# Emociones frente al cambio climático y zona de residencia

```{r relación nivel educativo zona}
tab_edu_zona <- table(data2$Zona, data2$education)
kable(round(prop.table(tab_edu_zona) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(4, "BrBG")
plot_edu_zona <- data2 %>%
  ggplot(aes(x = education, fill = Zona)) +
  geom_bar(position = "fill") +
  labs(x = "Nivel educativo", y = "Proporción", fill = "Zona") +
  ggtitle("Relación \n Zona y Nivel Educativo") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_edu_zona
```

```{r relación estrato zona}
tab_est_zona <- table(data2$Zona, data2$estrato)
kable(round(prop.table(tab_est_zona) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(4, "BrBG")
plot_est_zona <- data2 %>%
  ggplot(aes(x = estrato, fill = Zona)) +
  geom_bar(position = "fill") +
  labs(x = "Estrato", y = "Proporción", fill = "Zona") +
  ggtitle("Relación \n Zona y Estrato") +
  papaja::theme_apa() +
  scale_fill_manual(values = custom_palette)
plot_est_zona
```


```{r relación nivel educativo estrato}
tab_est_edu <- table(data2$education, data2$estrato)
kable(round(prop.table(tab_est_edu) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_est_edu <- data2 %>%
  ggplot(aes(x = education, fill = estrato)) +
  geom_bar(position = "fill") +
  labs(x = "Nivel educativo", y = "Proporción", fill = "Estrato") +
  ggtitle("Relación \n Estrato y Nivel Educativo") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_est_edu

plot_est_edu_2 <- data2 %>%
  ggplot(aes(x = estrato, fill = education)) +
  geom_bar(position = "fill") +
  labs(x = "Estrato", y = "Proporción", fill = "Nivel Educativo") +
  ggtitle("Relación \n Estrato y Nivel Educativo") +
  papaja::theme_apa() +
  scale_fill_manual(values = custom_palette)
plot_est_edu_2
```


```{r chi-square}
table0.1 <- table(data2$clim_ori, data2$env_aso)
table0.1
chisq.test(table0.1)

table0.2 <- table(data2$clim_ori, data2$education)
table0.2
chisq.test(table0.2)

table0.3 <- table(data2$clim_ori, data2$estrato)
table0.3
chisq.test(table0.3)

table0 <- table(data2$clim_ori, data2$imp_como)
table0
chisq.test(table0)

table1 <- table(data2$clim_ori, data2$imp_cli)
table1
chisq.test(table1)

table2 <- table(data2$clim_ori, data2$eco_anx)
table2
chisq.test(table2)

table3 <- table(data2$clim_ori, data2$thoughts)
table3
chisq.test(table3)

table4 <- table(data2$clim_ori, data2$ideology) #Not so interesting
table4
chisq.test(table4)

table9 <- table(data2$clim_ori, data2$trust_vote_inst)
table9
chisq.test(table9)

table5 <- table(data2$eco_anx, data2$thoughts) #Strong
table5
chisq.test(table5)

table6 <- table(data2$eco_anx, data2$ideology)
table6
chisq.test(table6)

table7 <- table(data2$eco_anx, data2$cont_clim)
table7
chisq.test(table7)

table8 <- table(data2$eco_anx, data2$trust_vote_inst)
table8
chisq.test(table8)

table10 <- table(data2$eco_anx, data2$imp_como)
table10
chisq.test(table10)

table11 <- table(data2$eco_anx, data2$env_aso)
table11
chisq.test(table11)
```


```{r relación origen cambio climatico y eco ansiedad}
tab_ori_eco_anx <- table(data2$clim_ori, data2$eco_anx)
kable(round(prop.table(tab_ori_eco_anx) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_ori_eco_anx <- data2 %>%
  ggplot(aes(x = clim_ori, fill = eco_anx)) +
  geom_bar(position = "fill") +
  labs(x = "Causa humana del \nCambio climático", y = "Proporción", fill = "Eco-ansiedad") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_ori_eco_anx
```


```{r relación impacto en la comodidad y eco ansiedad}
tab_th_eco_anx <- table(data2$thoughts, data2$eco_anx)
kable(round(prop.table(tab_th_eco_anx) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_th_eco_anx <- data2 %>%
  ggplot(aes(x = eco_anx, fill = thoughts)) +
  geom_bar(position = "fill") +
  labs(x = "Eco-ansiedad", y = "Proporción", fill = "Pensamientos frente al cambio climático") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_th_eco_anx
```


```{r relación ideologia y eco ansiedad}
tab_ide_eco_anx <- table(data2$ideology, data2$eco_anx)
kable(round(prop.table(tab_ide_eco_anx) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_ide_eco_anx <- data2 %>%
  ggplot(aes(x = ideology, fill = eco_anx)) +
  geom_bar(position = "fill") +
  labs(x = "Ideología política", y = "Proporción", fill = "Eco-ansiedad") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_ide_eco_anx
```


```{r relación impacto accion individual y eco ansiedad}
tab_cli_eco_anx <- table(data2$imp_cli, data2$eco_anx)
kable(round(prop.table(tab_cli_eco_anx) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_cli_eco_anx <- data2 %>%
  ggplot(aes(x = eco_anx, fill = imp_cli)) +
  geom_bar(position = "fill") +
  labs(x = "Eco-ansiedad", y = "Proporción", fill = "Impacto acciones \nIndividuales en \nel Cambio Climático") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_cli_eco_anx
```


```{r relación impacto en la comodidad y eco ansiedad}
tab_como_eco_anx <- table(data2$imp_como, data2$eco_anx)
kable(round(prop.table(tab_como_eco_anx) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_como_eco_anx <- data2 %>%
  ggplot(aes(x = eco_anx, fill = imp_como)) +
  geom_bar(position = "fill") +
  labs(x = "Eco-ansiedad", y = "Proporción", fill = "Impacto acciones \nIndividuales en \nComodidad") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_como_eco_anx
```


```{r relación unirse organizaciones ambientales y eco ansiedad}
tab_aso_eco_anx <- table(data2$env_aso, data2$eco_anx)
kable(round(prop.table(tab_aso_eco_anx) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_aso_eco_anx <- data2 %>%
  ggplot(aes(x = eco_anx, fill = env_aso)) +
  geom_bar(position = "fill") +
  labs(x = "Eco-ansiedad", y = "Proporción", fill = "Unirse a organizaciones ambientales") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_aso_eco_anx
```


```{r relación contribucion al cambio climatico y eco ansiedad}
tab_cont_eco_anx <- table(data2$cont_clim, data2$eco_anx)
kable(round(prop.table(tab_cont_eco_anx) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_cont_eco_anx <- data2 %>%
  ggplot(aes(x = eco_anx, fill = cont_clim)) +
  geom_bar(position = "fill") +
  labs(x = "Eco-ansiedad", y = "Proporción", fill = "Contribución al cambio climático") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_cont_eco_anx
```


```{r relación contribucion al cambio climatico y eco ansiedad}
tab_cont_eco_anx <- table(data2$cont_clim, data2$eco_anx)
kable(round(prop.table(tab_cont_eco_anx) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_cont_eco_anx <- data2 %>%
  ggplot(aes(x = eco_anx, fill = cont_clim)) +
  geom_bar(position = "fill") +
  labs(x = "Eco-ansiedad", y = "Proporción", fill = "Contribución al cambio climático") +
  papaja::theme_apa() +
  coord_flip() +
  scale_fill_manual(values = custom_palette)
plot_cont_eco_anx
```


```{r relación origen cambio climatico e impacto individual}
tab_ori_imp_cli <- table(data2$clim_ori, data2$imp_cli)
kable(round(prop.table(tab_ori_imp_cli) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_ori_imp_cli <- data2 %>%
  ggplot(aes(x = clim_ori, fill = imp_cli)) +
  geom_bar(position = "fill") +
  labs(x = "Origen Cambio Climático", y = "Proporción", fill = "Impacto acciones \nIndividuales en \nCambio climático") +
  papaja::theme_apa() +
  scale_fill_manual(values = custom_palette)
plot_ori_imp_cli
```


```{r relación origen cambio climatico e impacto en la comodidad}
tab_ori_imp_como <- table(data2$clim_ori, data2$imp_como)
kable(round(prop.table(tab_ori_imp_como) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_ori_imp_como <- data2 %>%
  ggplot(aes(x = clim_ori, fill = imp_como)) +
  geom_bar(position = "fill") +
  labs(x = "Origen Cambio Climático", y = "Proporción", fill = "Impacto acciones \nen la comodidad") +
  papaja::theme_apa() +
  scale_fill_manual(values = custom_palette)
plot_ori_imp_como
```


```{r relación origen cambio climatico e ideología}
tab_ori_ide <- table(data2$clim_ori, data2$ideology)
kable(round(prop.table(tab_ori_ide) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_ori_ide <- data2 %>%
  ggplot(aes(x = ideology, fill = clim_ori)) +
  geom_bar(position = "fill") +
  labs(x = "Ideología política", y = "Proporción", fill = "Origen Cambio Climático") +
  papaja::theme_apa() +
  scale_fill_manual(values = custom_palette)
plot_ori_ide
```


```{r relación origen cambio climatico y pensamientos sobre cambio climatico}
tab_ori_th <- table(data2$clim_ori, data2$thoughts)
kable(round(prop.table(tab_ori_th) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_ori_th <- data2 %>%
  ggplot(aes(x = clim_ori, fill = thoughts)) +
  geom_bar(position = "fill") +
  labs(x = "Causa humana del \nCambio climático", y = "Proporción", fill = "Pensamientos frente al cambio climático") +
  papaja::theme_apa() +
  scale_fill_manual(values = custom_palette)
plot_ori_th
```


```{r relación origen cambio climatico y unirse organizaciones ambientales}
tab_ori_aso <- table(data2$clim_ori, data2$env_aso)
kable(round(prop.table(tab_ori_aso) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_ori_aso <- data2 %>%
  ggplot(aes(x = env_aso, fill = clim_ori)) +
  geom_bar(position = "fill") +
  labs(x = "Unirse a organizaciones ambientales", y = "Proporción", fill = "Origen Cambio Climático") +
  papaja::theme_apa() +
  scale_fill_manual(values = custom_palette)
plot_ori_aso
```


```{r relación origen cambio climatico y educacion}
tab_ori_edu <- table(data2$clim_ori, data2$education)
kable(round(prop.table(tab_ori_edu) * 100, 1), booktabs = TRUE)

custom_palette <- brewer.pal(6, "BrBG")
plot_ori_edu <- data2 %>%
  ggplot(aes(x = clim_origin, fill = education)) +
  geom_bar(position = "fill") +
  labs(x = "Origen Cambio Climático", y = "Proporción", fill = "Nivel educativo alcanzado") +
  papaja::theme_apa() +
  scale_fill_manual(values = custom_palette)
plot_ori_edu
```


```{r logistic regression models}

```


